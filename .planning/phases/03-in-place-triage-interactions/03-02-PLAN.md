---
phase: 03-in-place-triage-interactions
plan: "02"
type: execute
wave: 2
depends_on:
  - 03-01
files_modified:
  - app/web/main.py
  - app/web/dense_list.py
  - tests/test_web_dense_list_contract.py
  - tests/integration/test_web_triage_interactions.py
autonomous: true
requirements:
  - DISC-02
  - KEYB-01
must_haves:
  truths:
    - "Detail panels show immediate skeleton and key fields, then progressively hydrate higher-priority sections first."
    - "Section-level failures keep successful sections visible and provide inline retry for failed sections."
    - "Keyboard shortcuts let operators focus quick search, move row focus, and toggle active row details without leaving queue context."
  artifacts:
    - path: app/web/main.py
      provides: "Detail-section JSON endpoints and priority section payload contract per queue context."
      contains: "triage detail sections|retry"
    - path: app/web/dense_list.py
      provides: "Progressive section loader, error/retry rendering, and keyboard interaction map."
      contains: "loading skeleton|retry section|keydown"
    - path: tests/integration/test_web_triage_interactions.py
      provides: "Integration checks for progressive loading behavior and keyboard shortcut outcomes."
      contains: "progressive|partial failure|keyboard"
  key_links:
    - from: app/web/dense_list.py
      to: app/web/main.py
      via: "Client requests per-section payloads and retries failed sections against JSON endpoints."
      pattern: "fetch|section|retry"
    - from: tests/test_web_dense_list_contract.py
      to: app/web/dense_list.py
      via: "Contract tests lock shortcut identifiers and progressive detail state hooks."
      pattern: "data-shortcut|data-detail-state"
---

<objective>
Add progressive detail loading and keyboard-first triage controls so in-place review remains fast under heavy queues.

Purpose: Complete DISC-02 and KEYB-01 after inline disclosure foundation exists.
Output: Section-based progressive loading with retry semantics plus deterministic shortcut behavior and tests.
</objective>

<execution_context>
@/home/n501/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/n501/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-in-place-triage-interactions/03-CONTEXT.md
@.planning/phases/03-in-place-triage-interactions/03-RESEARCH.md
@.planning/phases/03-in-place-triage-interactions/03-01-PLAN.md
@app/web/main.py
@app/web/dense_list.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement progressive detail section API and initial skeleton state</name>
  <files>app/web/main.py, app/web/dense_list.py</files>
  <action>Define a detail payload contract with prioritized sections (top triage fields first). On row open, render skeleton placeholders and initial high-priority values immediately, then asynchronously load remaining sections by priority. Keep list interactions responsive and avoid locking scroll or row navigation while sections load.</action>
  <verify>python -m pytest -q tests/integration/test_web_triage_interactions.py -k "progressive and detail"</verify>
  <done>Detail panels display immediate feedback and progressively hydrate section-by-section in priority order.</done>
</task>

<task type="auto">
  <name>Task 2: Add partial-failure handling with section retry</name>
  <files>app/web/main.py, app/web/dense_list.py</files>
  <action>Return section-scoped error states from detail endpoints and render inline error blocks only for failed sections. Provide a retry control per failed section while preserving already-loaded content and current row context. Ensure failures do not collapse the panel or clear expanded-row state.</action>
  <verify>RUN_INTEGRATION_TESTS=1 TEST_DATABASE_URL=postgresql+asyncpg://.../auction_test python -m pytest -q tests/integration/test_web_triage_interactions.py -k "retry or partial"</verify>
  <done>Operators can recover failed detail sections without losing loaded information or queue position.</done>
</task>

<task type="auto">
  <name>Task 3: Implement and lock keyboard-first triage shortcuts</name>
  <files>app/web/dense_list.py, tests/test_web_dense_list_contract.py, tests/integration/test_web_triage_interactions.py</files>
  <action>Add explicit shortcut mapping for focus-search, row-next/row-prev navigation, and open/close detail on focused row. Suppress shortcuts while typing in inputs/selects/textareas. Add contract and integration tests validating shortcut behavior, focus placement, and no-op safety at list boundaries.</action>
  <verify>RUN_INTEGRATION_TESTS=1 TEST_DATABASE_URL=postgresql+asyncpg://.../auction_test python -m pytest -q tests/test_web_dense_list_contract.py tests/integration/test_web_triage_interactions.py -k "keyboard or shortcut"</verify>
  <done>Keyboard interactions support fast triage without disrupting input fields or list context.</done>
</task>

</tasks>

<verification>
Run triage integration tests for progressive loading + retries and dense-list contract/integration checks for keyboard shortcuts.
</verification>

<success_criteria>
Detail loading is progressive and fault-tolerant, and keyboard-first triage actions are deterministic and regression-protected.
</success_criteria>

<output>
After completion, create `.planning/phases/03-in-place-triage-interactions/03-in-place-triage-interactions-02-SUMMARY.md`
</output>
