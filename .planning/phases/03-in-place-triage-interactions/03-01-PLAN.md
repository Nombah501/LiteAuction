---
phase: 03-in-place-triage-interactions
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - app/web/main.py
  - app/web/dense_list.py
  - tests/test_web_dense_list_contract.py
  - tests/integration/test_web_triage_interactions.py
autonomous: true
requirements:
  - DISC-01
  - DISC-03
must_haves:
  truths:
    - "Operators can open and close inline row details without leaving queue page context or losing active filters."
    - "Multiple rows can stay expanded simultaneously and remain within a strict two-level disclosure model (list + details only)."
    - "Closing details restores focus and preserves scroll position for continued triage."
  artifacts:
    - path: app/web/main.py
      provides: "Queue row/detail markup and route wiring for inline disclosure state."
      contains: "data-triage-row|data-triage-detail|expanded"
    - path: app/web/dense_list.py
      provides: "Dense-list script behavior for inline open/close, dimming, and focus return."
      contains: "triage|expandedRows|focus"
    - path: tests/integration/test_web_triage_interactions.py
      provides: "DB-backed assertions for in-place disclosure and context retention."
      contains: "inline detail|context preserve|two-level"
  key_links:
    - from: app/web/main.py
      to: app/web/dense_list.py
      via: "Route markup emits triage data hooks consumed by dense-list interaction script."
      pattern: "data-triage-"
    - from: tests/integration/test_web_triage_interactions.py
      to: app/web/main.py
      via: "Integration tests verify queue routes keep disclosure state in-place without navigation depth growth."
      pattern: "complaints|signals|appeals|trade_feedback"
---

<objective>
Lay down the in-place disclosure foundation so operators can inspect rows inline and continue triage without context loss.

Purpose: Implement stable list+detail structure first, before progressive loading and advanced interaction layers.
Output: Queue markup + dense-list behavior + integration tests proving DISC-01 and DISC-03 baseline contracts.
</objective>

<execution_context>
@/home/n501/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/n501/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-in-place-triage-interactions/03-CONTEXT.md
@.planning/phases/03-in-place-triage-interactions/03-RESEARCH.md
@app/web/main.py
@app/web/dense_list.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add inline detail-row structure on triage queues</name>
  <files>app/web/main.py</files>
  <action>Extend `complaints`, `signals`, `appeals`, and `trade_feedback` table rendering so each data row has an adjacent inline details container row (`data-triage-detail`) bound by stable row ids. Keep details inside the same table context, avoid nested navigation links for details-only exploration, and preserve existing queue filters/page/density query behavior.</action>
  <verify>python -m pytest -q tests/integration/test_web_triage_interactions.py -k "inline and structure"</verify>
  <done>Queue pages render list+detail as one in-place interaction model and no third disclosure level exists.</done>
</task>

<task type="auto">
  <name>Task 2: Implement open/close behavior with focus and scroll preservation</name>
  <files>app/web/dense_list.py</files>
  <action>Add triage controls to dense-list script so operators can expand/collapse rows inline, keep multiple expanded rows, visually dim non-active rows when any detail is open, and return focus to the invoking row control on close. Preserve active filter text, row visibility, and list scroll offset during toggles.</action>
  <verify>python -m pytest -q tests/test_web_dense_list_contract.py -k "triage and focus"</verify>
  <done>Inline detail interactions are stable, keyboard-focus-safe, and do not reset list context.</done>
</task>

<task type="auto">
  <name>Task 3: Add disclosure baseline integration coverage</name>
  <files>tests/test_web_dense_list_contract.py, tests/integration/test_web_triage_interactions.py</files>
  <action>Create contract and DB-backed tests asserting: inline detail rows render for all four queue contexts, expanded state is independent per row, close returns focus to trigger, and disclosure depth remains exactly two levels (list and details). Include regression for preserving active quick filter while opening/closing rows.</action>
  <verify>RUN_INTEGRATION_TESTS=1 TEST_DATABASE_URL=postgresql+asyncpg://.../auction_test python -m pytest -q tests/test_web_dense_list_contract.py tests/integration/test_web_triage_interactions.py -k "triage or disclosure"</verify>
  <done>Automated evidence locks DISC-01 and DISC-03 baseline behavior for in-place triage.</done>
</task>

</tasks>

<verification>
Run dense-list contract tests and triage integration tests to prove inline disclosure and context retention behavior.
</verification>

<success_criteria>
In-place disclosure foundation is in place: operators open multiple inline details, keep queue context intact, and stay within two-level disclosure limits.
</success_criteria>

<output>
After completion, create `.planning/phases/03-in-place-triage-interactions/03-in-place-triage-interactions-01-SUMMARY.md`
</output>
