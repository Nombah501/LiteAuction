---
phase: 01-dense-list-foundations
plan: "02"
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - app/web/dense_list.py
  - app/web/main.py
  - tests/test_web_dense_list_contract.py
  - tests/integration/test_web_dense_list_foundations.py
autonomous: true
requirements:
  - DENS-01
  - FILT-01
  - FILT-02
must_haves:
  truths:
    - "Operators can switch list density between compact, standard, and comfortable on queue pages."
    - "Quick filter narrows currently rendered rows immediately without a page submit."
    - "Advanced qualifiers remain server-validated and stay preserved in pagination/filter links."
  artifacts:
    - path: app/web/dense_list.py
      provides: "Shared dense list metadata/render helpers used by queue routes."
      exports: ["DenseListConfig", "render_dense_list_toolbar", "render_dense_list_script"]
    - path: app/web/main.py
      provides: "Queue routes wired to dense toolbar, quick filter markup, and advanced filter query builders."
      contains: "complaints|signals|trade_feedback|auctions|manage_users|violators|appeals"
    - path: tests/integration/test_web_dense_list_foundations.py
      provides: "Integration assertions for density controls and dual-layer filtering behavior."
      contains: "quick filter|density"
  key_links:
    - from: app/web/main.py
      to: app/web/dense_list.py
      via: "Route render flow imports dense list helpers for toolbar/script output"
      pattern: "from app.web.dense_list import|render_dense_list_"
    - from: app/web/main.py
      to: tests/integration/test_web_dense_list_foundations.py
      via: "HTML includes quick-filter data attributes and density control state"
      pattern: "data-quick-filter|data-density"
---

<objective>
Wire dense list controls and two-layer filtering into queue pages without weakening server-side validation.

Purpose: Deliver fast scanning ergonomics (density + instant narrowing) while preserving trusted backend filtering paths.
Output: Shared dense-list web helpers, updated queue route HTML/script contracts, and integration coverage.
</objective>

<execution_context>
@/home/n501/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/n501/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-dense-list-foundations/01-RESEARCH.md
@.planning/phases/01-dense-list-foundations/01-01-PLAN.md
@app/web/main.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared dense-list web contract helpers</name>
  <files>app/web/dense_list.py</files>
  <action>Add a focused helper module for queue table metadata and rendering primitives (density options, quick-filter labels, route queue keys, HTML data attributes, and bootstrap script output). Keep logic reusable so all queue routes share one contract and avoid per-route drift.</action>
  <verify>python -m pytest -q tests/test_web_dense_list_contract.py -k contract</verify>
  <done>Dense-list helpers produce deterministic toolbar/script HTML for all target queue routes.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate density switch and quick filter across queue routes</name>
  <files>app/web/main.py</files>
  <action>Update `complaints`, `signals`, `trade_feedback`, `auctions`, `manage_users`, `violators`, and `appeals` routes to render density controls plus a quick-filter input tied to row-level `data-row` markup and client-side `input` event filtering. Keep advanced qualifiers parsed/validated on the server exactly as today; only augment URL builders so qualifier params continue to survive page and chip navigation.</action>
  <verify>python -m pytest -q tests/integration/test_web_trade_feedback.py tests/integration/test_web_appeals.py -k "filter or pagination"</verify>
  <done>Density can be switched on queue pages, quick filter narrows visible rows instantly, and server qualifier behavior/regressions remain unchanged.</done>
</task>

<task type="auto">
  <name>Task 3: Add dense-list route integration tests</name>
  <files>tests/test_web_dense_list_contract.py, tests/integration/test_web_dense_list_foundations.py</files>
  <action>Create targeted tests that assert density controls render with valid active state, quick-filter markup/script markers exist, and advanced qualifier links retain current query context. Include invalid qualifier tests where applicable to confirm HTTP 400 behavior is preserved.</action>
  <verify>RUN_INTEGRATION_TESTS=1 TEST_DATABASE_URL=postgresql+asyncpg://.../auction_test python -m pytest -q tests/test_web_dense_list_contract.py tests/integration/test_web_dense_list_foundations.py -k "density or filter"</verify>
  <done>Automated tests prove DENS-01/FILT-01/FILT-02 behavior on queue pages and guard against query-link regressions.</done>
</task>

</tasks>

<verification>
Run targeted integration tests for density UI and filtering, plus existing route filter tests to confirm no regressions.
</verification>

<success_criteria>
Queue pages expose working density and quick-filter controls, while advanced filtering remains server-authoritative and stable.
</success_criteria>

<output>
After completion, create `.planning/phases/01-dense-list-foundations/01-dense-list-foundations-02-SUMMARY.md`
</output>
